<!--File: mini_insta/templates/mini_insta/show_profile.html
Author: Yi Ji (Wayne) Wang (waynew@bu.edu), 10/17/2025
Description: A template to display a single profile and its posts.
-->

{% extends 'mini_insta/base.html' %}
{% load static %}

{% block content %}

    <!-- table containing the portion of the profile above the bio -->
    <table class="profile-table">
        <tr>
            <!-- left column to hold the profile picture -->
            <td>
                <img class="pfp circle large mr-50" src="{{profile.profile_image_url}}">
            </td>

            <!-- right column to hold the profile name and stats -->
            <td>
                <h1 class="large inline ml-20">{{profile.display_name}}</h1>

                <!-- button to update the profile -->
                <a class="update-profile-link" href="{% url 'update_profile' profile.pk %}">
                    <input class="button-input" type="button" value="Edit Profile">
                </a>

                <br>

                <!-- number of posts, followers, and following stats -->
                <div class="stat-div">
                    <h1 class="small no-margin">Posts</h1>
                    <h1 class="small no-margin">{{profile.get_all_posts.count}}<h1>
                </div>

                <a href="{% url 'show_followers' profile.pk %}">
                    <div class="stat-div">
                        <h1 class="small no-margin">Followers</h1>
                        <h1 class="small no-margin">{{profile.get_num_followers}}</h1>
                    </div>
                </a>

                <a href="{% url 'show_following' profile.pk %}">
                    <div class="stat-div">
                        <h1 class="small no-margin">Following</h1>
                        <h1 class="small no-margin">{{profile.get_num_following}}</h1>
                    </div>
                </a>
            </td>
        </tr>
    </table>

    <!-- div containing the profile's join date and bio -->
    <div class="bio-div">
        <p><strong>Joined on {{profile.join_date}}</strong></p>

        <p>{{profile.bio_text | linebreaksbr}}</p>

        <h1 class="medium">Posts</h1>
    </div>

    {% if not profile.get_all_posts %}
        <p>No posts</p>
    {% endif %}

    <!-- div containing the profile's posts -->
    <div class="posts-grid">
        <!-- loop to process each post in the profile to
         display all of them at once -->
        {% for post in profile.get_all_posts %}
            <div>
                <!-- link to view a post in detail using its PK -->
                <a href="{% url 'show_post' post.pk %}">

                    <!-- if the post has photos, display the first photo -->
                    {% if post.get_all_photos.0.get_image_url %}
                        <img class="photo small clickable" src="{{post.get_all_photos.0.get_image_url}}">

                    <!-- otherwise, display an alternate image saying 'no photo' -->
                    {% else %}
                        <img class="photo small clickable" src="{% static 'mini_insta/img/no-photo.png' %}">
                    {% endif %}
                </a>
                
                <p>{{post.timestamp.date}}</p>
            </div>
        {% endfor %}
    </div>
    
{% endblock %}